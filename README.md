# generate-person-data-json
Generate Random Person Data with JSON file for Testing. 
This makes the use of `gofakeit` random fake data generator. I find this better and with constant updates in compare to `go-randomdata`. 

## Dependencies

1. Install the `gofakeit` package for generating fake data:
```bash 
go get github.com/brianvoe/gofakeit/v7
```

2. Install the `gin` package for HTTP server functionality:
```bash
go get github.com/gin-gonic/gin
```

3. Install `golangci-lint` for linting support. See the install [link](https://golangci-lint.run/welcome/install/#local-installation). After install check the version.
```bash
golangci-lint --version
```

## Running the Program
1. Run the program with optional parameters `-n` for number of records to generate. Use `-o` to overwrite the default file name.
```bash
go run generate_json.go -n 500 -o my_data.json
```
2. By default if no parameters are passed, it will generate `100` record into `fake_pii_data.json` file.
```bash
 go run generate_json.go
```
or
```bash
go run generate_json.go -o custom_output.json
```
3. To see the help message generated by the `flag` package.
```bash
go run generate_json.go -h 
```

## Running with Docker
You can also run the application using Docker. You will need Docker or Podman.
Podman is a drop-in replacement for Docker. 

### Using Docker commands directly

1. Build the Docker image:
```bash
docker build -t generate-person-data-json .
```

2. Run the container in server mode (default):
```bash
docker run -p 8080:8080 generate-person-data-json
```

3. Run the container to generate JSON data:
```bash
# Generate data with default settings (100 records to fake_pii_data.json)
docker run -v $(pwd):/output generate-person-data-json --server=false

# Generate custom number of records with custom filename
docker run -v $(pwd):/output generate-person-data-json --server=false -n 500 -o /output/my_data.json

# Show help
docker run generate-person-data-json -h
```

Note: When generating files, you need to mount a volume to access the generated files from your host system.

### Using Makefile commands

The project includes Makefile commands for Docker operations:

## Building the Docker image and runtime

1. Build the Docker image:
```bash
make docker-build
```

2. Run the container in server mode:
```bash
make docker-run-server
```

3. Run the container to generate data:
```bash
make docker-run-generate
```

## Building the module
1. First build the executable
```bash
go build generate_json.go 
```
2. Running the Executable
```bash
./generate_json -n 100000 -o large_fake_data.json 
```

## HTTP Server Mode
The program can also be run as an HTTP server that exposes the person data generation functionality via a REST API.

1. Run the program in server mode:
```bash
go run generate_json.go -server
```

2. By default, the server runs on port 8080. You can specify a different port:
```bash
go run generate_json.go -server -port :3000
```

3. Available API endpoints:
   - `GET /health` - Health check endpoint that returns a status of "ok"
   - `GET /api/persons` - Generate and return person data as JSON
     - Query parameter: `n` - Number of records to generate (default: 10)
     - Example: `GET /api/persons?n=50` - Generate 50 person records

4. Example of using the API with curl:
```bash
# Health check
curl http://localhost:8080/health

# Generate 20 person records
curl http://localhost:8080/api/persons?n=20
```

## Load Testing
The project includes load testing capabilities using the K6 open source load testing tool.

1. Install K6 by following the [official installation guide](https://k6.io/docs/getting-started/installation/)

2. Start the server in one terminal:
```bash
make server
```

3. Run the load test in another terminal:
```bash
make load-test
```

For more detailed information about the load testing setup, scenarios, and how to interpret results, see the [Load Testing README](LOADTEST_README.md).

## TODO
- [x] Refactor the code and see if we can make use of some other features of `gofakeit`
- [x] Go `struct` is powerful and can include additional tags to reduce the boilerplate codes.
- [x] Add Unit Testing 
- [x] Add Load Testing with K6
- [x] Add Dockerfile
- [ ] Add more API endpoints for specific data generation needs
- [ ] Implement rate limiting for the API
- [ ] Add authentication for the API
